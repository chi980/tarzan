# Step 1: Build the application
FROM openjdk:17-jdk as builder


# Build arguments
ARG DB_URL
ARG DB_USERNAME
ARG DB_PASSWORD
ARG GOOGLE_CLIENT_ID
ARG GOOGLE_CLIENT_SECRET
ARG KAKAO_CLIENT_ID
ARG KAKAO_CLIENT_SECRET
ARG JWT_SECRET_KEY
ARG VWORLD_API_KEY
ARG SEOUL_API_KEY

# Set environment variables using the build arguments
ENV DB_URL=${DB_URL}
ENV DB_USERNAME=${DB_USERNAME}
ENV DB_PASSWORD=${DB_PASSWORD}
ENV GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
ENV GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
ENV KAKAO_CLIENT_ID=${KAKAO_CLIENT_ID}
ENV KAKAO_CLIENT_SECRET=${KAKAO_CLIENT_SECRET}
ENV JWT_SECRET_KEY=${JWT_SECRET_KEY}
ENV VWORLD_API_KEY=${VWORLD_API_KEY}
ENV SEOUL_API_KEY=${SEOUL_API_KEY}

RUN echo "DB_URL: $DB_URL" && \
    echo "DB_USERNAME: $DB_USERNAME" && \
    echo "JWT_SECRET_KEY is set: " && \
    ( [ -z "$JWT_SECRET_KEY" ] && echo "not set" || echo "set" )


COPY build/libs/*.jar app.jar
ENTRYPOINT ["java", "-Djava.security.egd=file:/dev/./urandom", "-jar", "/app.jar"]
